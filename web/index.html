<!DOCTYPE html>
<html>
<head>
  <!-- Base href configuration -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta name="google-signin-client_id" content="816767361642-i9khbguakccver03skj6d56qcttij27q.apps.googleusercontent.com" />
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="Digital Certificate Repository - A secure mobile application for Certificate Authorities and recipients.">
  
  <!-- Content Security Policy optimized for Flutter Web and Firebase Storage -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.gstatic.com https://apis.google.com https://accounts.google.com https://firebasestorage.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://accounts.google.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: blob: https://firebasestorage.googleapis.com; connect-src 'self' https: wss: blob: https://firebasestorage.googleapis.com https://storage.googleapis.com; worker-src 'self' blob:; child-src 'self' blob:; frame-src 'self' https://accounts.google.com; object-src 'none';"
  
  <!-- Other security headers that work in meta tags -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <meta name="robots" content="noindex, nofollow">

  <!-- PWA Meta Tags -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Digital Certificate Repository">
  <meta name="msapplication-TileColor" content="#2196F3">
  <meta name="theme-color" content="#2196F3">

  <!-- Responsive Design -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>Digital Certificate Repository</title>
  <link rel="manifest" href="manifest.json">

  <!-- Preload critical resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://accounts.google.com">
  <link rel="preconnect" href="https://apis.google.com">

  <!-- Google Sign-In SDK -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="192x192" href="icons/Icon-192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/Icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/Icon-512.png">
</head>

<body>
  <!-- Loading indicator -->
  <div id="loading" style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #2196F3, #21CBF3);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    color: white;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  ">
    <div style="
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 20px;
    "></div>
    <h2 style="margin: 0; font-weight: 300;">Digital Certificate Repository</h2>
    <p style="margin: 10px 0 0 0; opacity: 0.8;">Loading secure environment...</p>
  </div>

  <style>
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    body {
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      overflow: hidden;
    }
    
    /* Hide loading when Flutter loads */
    body.flutter-loaded #loading {
      display: none;
    }
  </style>

  <!-- Firebase configuration -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
    import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
    import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';
    
    // ⚠️ Important: Ensure these configurations match the Web configuration in firebase_options.dart
    const firebaseConfig = {
      apiKey: "AIzaSyBOC92kC8R8Irojea4IGTW8yA71bzfP6aA",
      authDomain: "mobile-project-63d46.firebaseapp.com",
      projectId: "mobile-project-63d46",
      storageBucket: "mobile-project-63d46.appspot.com",
      messagingSenderId: "816767361642",
      appId: "1:816767361642:web:d18b39e3e3b18004e66013",
      measurementId: "G-H3NV75DTBT"
    };
    
    window.firebaseApp = initializeApp(firebaseConfig);
    window.firebaseAuth = getAuth();
    window.firebaseFirestore = getFirestore();
  </script>

  <!-- Flutter bootstrap -->
  <script src="flutter_bootstrap.js" async></script>
  
  <!-- Remove loading screen when Flutter is ready -->
  <script>
    window.addEventListener('flutter-first-frame', function() {
      document.body.classList.add('flutter-loaded');
      setTimeout(() => {
        const loading = document.getElementById('loading');
        if (loading) {
          loading.style.opacity = '0';
          loading.style.transition = 'opacity 0.5s ease-out';
          setTimeout(() => loading.remove(), 500);
        }
      }, 1000);
    });
    
    // Fallback removal after 10 seconds
    setTimeout(() => {
      const loading = document.getElementById('loading');
      if (loading) {
        loading.style.opacity = '0';
        loading.style.transition = 'opacity 0.5s ease-out';
        setTimeout(() => loading.remove(), 500);
      }
    }, 10000);
  </script>
</body>
</html>
